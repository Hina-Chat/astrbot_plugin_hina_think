# Hina Think

Powered by Claude 4s & Gemini 2.5 Pro, All.

本插件基於 [R1-filter](https://github.com/Soulter/astrbot_plugin_r1_filter) 二次開發。

一個 AstrBot 模組，專注於捕獲並匯出 AI 的思維鏈。

根據個人需求客制化，代碼規範未遵循設計規範。如果您有興趣規範化開發，請隨意。

## 功能概述

本插件的核心是 **“自動化思維鏈日誌”** 與 **“手動匯出分享”** 相結合，提供從偵錯到歸檔的全鏈路解決方案。

### 1. 全自動後台日誌 (核心功能)

- **靜默記錄**: 插件在後台自動運行，當檢測到語言模型返回的響應中包含思維鏈（Reasoning）時，會立即將該次對話的完整上下文（用戶提問、模型回答、思維鏈詳情）保存為本地日誌。
- **持久化存儲**: 所有日誌均按會話（Session）進行分類和輪轉存檔，確保歷史記錄的完整性和易於管理。

### 2. 即時偵錯與回溯

- **`/think` 指令**: 當您想快速查看模型“剛剛”是如何思考的時候，使用此指令可立即在聊天窗口中顯示 **上一次對話** 的思維鏈。如果內容過長，會自動進行截斷顯示，同時將完整的思維鏈匯出為單獨的 `.json` 文件存放在本地，方便您深入分析。

### 3. 會話匯出與個性化分享

- **`/memohina` 指令**: 這是用於正式分享和歸檔的強大工具。它會將 **當前整個會話** 的所有日誌記錄打包上傳至您配置的 Cloudflare R2 桶，並生成一個公開的分享 Link。
- **個性化 QR 碼工坊**: 在生成分享鏈接的同時，插件會創建一個高度自定義的 QR 碼，您可以：
    - **自由塑形**: 定義碼點形狀（`方塊`、`圓角`、`圓點`）和邊框。
    - **自由紋理**: 使用您喜歡的圖片作為 **圖片蒙版**。
    - **自由標識**: 在中心嵌入您的專屬 **Logo**。

## 配置

### 1. 通用設置 (`general`)

-   **存儲目錄 (`storage_dir`)**：存儲匯出 HTML 文件的本地臨時目錄。默認為插件目錄下的 `hina_thoughts_data`。

### 2. R2 存儲設置 (`r2`)

-   **Endpoint URL (`r2_endpoint_url`)**
-   **Access Key ID (`r2_access_key_id`)**
-   **Secret Access Key (`r2_secret_access_key`)**
-   **存儲桶名稱 (`r2_bucket_name`)**
-   **公共訪問域名 (`r2_public_domain`)**

這些是連接到 Cloudflare R2 所需的憑證和信息。請確保填寫正確，以便文件能成功上傳和通過公共域名訪問。

### 3. QR Code 樣式 (`qrcode`)

本插件提供了豐富的 QR 碼個性化選項，讓您的分享與眾不同。

-   **碼點大小 (`qr_box_size`)**：控制 QR 碼每個模塊（黑白點）的像素大小。數值越大，生成的圖片尺寸越大。
-   **邊框寬度 (`qr_border`)**：控制 QR 碼四周空白邊框的寬度。
-   **碼點形狀 (`qr_module_drawer`)**：設置碼點的樣式，支持以下幾種預設：
    -   `square`：經典實心方塊
    -   `gapped`：帶有間隙的方塊
    -   `circle`：圓點
    -   `rounded`：圓角方塊
-   **圖片蒙版 (`qr_image_mask_path`)**：為 QR 碼應用圖片紋理。碼點將以蒙版圖片的樣式呈現。支持**本地文件路徑**或**網絡圖片 URL**。
-   **中心 LOGO (`qr_logo_path`)**：在 QR 碼的中心嵌入一個 Logo。插件會自動提高容錯率以確保可掃描性。同樣支持**本地文件路徑**或**網絡圖片 URL**。

> [!NOTE]
> 當使用圖片蒙版時，背景會被設置為透明。您可以同時使用圖片蒙版和中心 Logo，創造出獨一無二的視覺效果。

## 許可證

本插件使用了以下第三方套件：

| 套件       | 授權       | 來源                                               |
|------------|------------|----------------------------------------------------|
| boto3      | Apache 2.0 | https://github.com/boto/boto3                      |
| qrcode[pil]| BSD / HPND | https://github.com/lincolnloop/python-qrcode      |
| Pillow     | HPND       | https://github.com/python-pillow/Pillow           |